<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DODO Flash Loan Arbitrage</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      background-color: #001a00;
      color: #39ff14;
      font-family: monospace;
      padding: 20px;
    }
    input, select, button {
      margin: 5px;
      padding: 5px;
      background-color: #002b00;
      color: #39ff14;
      border: 1px solid #39ff14;
      border-radius: 4px;
    }
    .log {
      border: 1px solid #39ff14;
      padding: 10px;
      margin-top: 20px;
      height: 300px;
      overflow-y: auto;
      background-color: #000;
    }
    .log-entry {
      border-bottom: 1px dashed #39ff14;
      margin-bottom: 5px;
      padding-bottom: 5px;
    }
    .log-entry.profit {
      color: #00ff00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>DODO Flash Loan Arbitrage</h1>

  <label>Token Address: <input id="token" type="text" /></label><br/>
  <label>Manual Bribe (in GWEI): <input id="bribe" type="number" value="0.005" /></label><br/>
  <button onclick="start()">Start Arbitrage</button>
  <div class="log" id="log"></div>

  <script>
    const RPCs = [
      "https://polygon-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY",
      "https://rpc.ankr.com/polygon",
      "https://polygon-rpc.com"
    ];

    const contractAddress = "0x2498Bc50732a655F0DbEa3319B1Cd7DDec884b6a";
    const contractABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "baseAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "quoteAmount",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "DPPFlashLoanCall",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "token0",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "token1",
				"type": "address"
			},
			{
				"internalType": "uint8",
				"name": "dexPath",
				"type": "uint8"
			}
		],
		"name": "initiateArbitrage",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_wei",
				"type": "uint256"
			}
		],
		"name": "setBribe",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "setFlashAmount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_bps",
				"type": "uint256"
			}
		],
		"name": "setMinProfit",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_bps",
				"type": "uint256"
			}
		],
		"name": "setSlippage",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_treasury",
				"type": "address"
			}
		],
		"name": "setTreasury",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawMatic",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "token",
				"type": "address"
			}
		],
		"name": "withdrawToken",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "APE",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "apeSwap",
		"outputs": [
			{
				"internalType": "contract IUniswapV2Router",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "bribe",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "buyPath",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "DODO_POOL",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "flashAmount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "MATIC",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minProfitBps",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "quickSwap",
		"outputs": [
			{
				"internalType": "contract IUniswapV2Router",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "QUICKSWAP",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "sellPath",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "slippageBps",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "SUSHI",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "sushiSwap",
		"outputs": [
			{
				"internalType": "contract IUniswapV2Router",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "treasury",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "USDC",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

    const USDC_ADDRESS = "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174";

    function log(msg, isProfit = false) {
      const logDiv = document.getElementById("log");
      const entry = document.createElement("div");
      entry.className = "log-entry" + (isProfit ? " profit" : "");
      entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
      logDiv.prepend(entry);
    }

    async function sendWithFallback(txPopulator) {
      for (let i = 0; i < RPCs.length; i++) {
        try {
          const provider = new ethers.providers.JsonRpcProvider(RPCs[i]);
          const signer = new ethers.providers.Web3Provider(window.ethereum).getSigner();
          const contract = new ethers.Contract(contractAddress, contractABI, signer.connect(provider));

          const tx = await txPopulator(contract);
          const sent = await signer.sendTransaction(tx);
          const receipt = await sent.wait();

          log(`✅ Success via RPC ${i + 1}: ${RPCs[i]} | Tx Hash: ${receipt.transactionHash}`, true);
          return;
        } catch (err) {
          log(`❌ Failed with RPC ${i + 1}: ${RPCs[i]} | ${err.message}`);
          if (i === RPCs.length - 1) {
            log("⛔ All providers failed to send transaction.");
          }
        }
      }
    }

    async function start() {
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      const tokenAddress = document.getElementById("token").value;
      const bribeGwei = parseFloat(document.getElementById("bribe").value || "0");
      const bribeWei = ethers.utils.parseUnits(bribeGwei.toString(), "gwei");

      log("Preparing arbitrage transaction...");

      await sendWithFallback(async (contract) => {
        const txRequest = await contract.populateTransaction.initiateArbitrage(
          USDC_ADDRESS,
          tokenAddress,
          bribeWei
        );
        return txRequest;
      });
    }
  </script>
</body>
</html>
